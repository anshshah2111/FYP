
<!-- {% load static %} -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Montserrat:100,200,300,400,500,600,700,800,900" rel="stylesheet">

    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    
    <title>Speech Processing by NLP</title>
    <link rel="stylesheet" href="../static/style.css" />
   <link rel="stylesheet" href="../static/css/button2.css" /> 
   <link rel="icon" type="image/png" href="../static/images/fac.png"/>


    
   <!-- Bootstrap core CSS -->
   <link href="../static/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
   <link href='https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css'>

   
   <link rel="stylesheet" href="../static/css/fontawesome.css">
   <link rel="stylesheet" href="../static/css/templatemo-grad-school.css">
   <link rel="stylesheet" href="../static/css/owl.css">
   <link rel="stylesheet" href="../static/css/lightbox.css">
  </head>
  <body style="padding: 0; background-image: url(../static/images/nlp.png); background-size: cover;   font-family: 'Montserrat'; font-weight: 500;
  ">

    <header class="main-header clearfix" role="header">
      <div class="logo">
        <a href="/fyp"><em>VLN</em> System</a>
      </div>
      <a href="#menu" class="menu-link"><i class="fa fa-bars"></i></a>
      <nav id="menu" class="main-nav" role="navigation">
        <ul class="main-menu">
          <li></li><a href="#section2"></a> </li>
          <li><a href="#section2">System Modules</a>
          </li>
          <li><a href="#section4">Properties</a></li>
           <li><a href="#section5">Video</a></li>
          <li><a href="/workspace" class="external">Workspace</a></li>
        </ul>
      </nav>
    </header>


<!--     <main class="mt-5">
      <button id="button" class="mt-5">Start listening</button>
      <div id="result" style="color: white;"></div>
      <p id="goal_location" style="color: white;"></p>
      <p id="message" hidden aria-hidden="true">
        Your browser doesn't support Speech Recognition. Sorry.
      </p>
       <div id="ansh">
        <ul id="y">
          <li id="x"><span>Go to path Navigation</span></li>
         
        </ul>
        </div> 
      
    </main> -->
    <div class="container">
      <div class="row mt-5 justify-content-center">
        <div class="col-md-6 my-5">
          <img src="../static/images/office.jpg" style="width: 100%; height: 100%">
        </div>
        <div class="col-md-6 my-5">
          <img src="../static/images/detection2.jpg" id="od" style="width: 100%; height: 100%; visibility: hidden;">
        </div>
      </div>
      <div class="row justify-content-center">
        <button onclick="od()">Detect Objects</button><br>
        <!-- <h6 style="color: white;">Object Detection algorithm uses the YOLOv3 Model, trained on the MS COCO Dataset</h6> -->
      </div>
    </div>

    <script>
      function od(){
        setTimeout(function(){
            document.getElementById("od").style.visibility = "visible";
          }, 3000);
        

      }
      window.addEventListener("DOMContentLoaded", () => {
        const button = document.getElementById("button");
        const result = document.getElementById("result");
        const goal_location = document.getElementById("goal_location");
        const main = document.getElementsByTagName("main")[0];
        let listening = false;
        const SpeechRecognition =
          window.SpeechRecognition || window.webkitSpeechRecognition;
        if (typeof SpeechRecognition !== "undefined") {
          const recognition = new SpeechRecognition();

          const stop = async() => {
            main.classList.remove("speaking");
            recognition.stop();
            button.textContent = "Start listening";
            console.log(result.textContent)
            //API request here
            try {
            var bodyFormData = new FormData();
            bodyFormData.append('instruction',result.textContent);
        
            const res=await axios.post('/check/',bodyFormData);
            console.log(res.data.message);
            console.log(JSON.stringify(res))
            var gl="The predicted Goal Location is ";
            if(res.data.message)
            {
              goal_location.textContent=gl.concat(res.data.message)  
            }
            else
            {
            goal_location.textContent="Goal Location Unidentified";
            }
                
            } catch (error) {
                console.log(error);
                
            }
           
            
          };

          const start = () => {
            main.classList.add("speaking");
            recognition.start();
            button.textContent = "Stop listening";
          };

          const onResult = event => {
            result.innerHTML = "";
            var final_text=""
            for (const res of event.results) {
              const text = document.createTextNode(res[0].transcript);
              const p = document.createElement("p");
              if (res.isFinal) {
                p.classList.add("final");
                
                
              }
              p.appendChild(text);
              result.appendChild(p);
              final_text.concat(p.textContent)
            //   console.log(p.textContent)
              
            }
            // console.log(result.textContent)
          };
          recognition.continuous = true;
          recognition.interimResults = true;
          recognition.addEventListener("result", onResult);
          button.addEventListener("click", event => {
            listening ? stop() : start();
            listening = !listening;
          });
        } else {
          button.remove();
          const message = document.getElementById("message");
          message.removeAttribute("hidden");
          message.setAttribute("aria-hidden", "false");
        }
      });
    </script>
    <!-- <script src="../static/js/button2.js"></script>  -->
    <footer style="position: absolute; bottom:0px; width: 100%;">  
      <div class="container">
        <div class="row">
          <div class="col-md-12">
            <p><i class="fa fa-copyright justify-content-center"></i> Copyright 2021 by Ansh, Parth Kansara & Parth Meswani 
            
             | Design: <a href="https://templatemo.com" rel="sponsored" target="_parent">Fulfilled for Final Year Project</a></p>
          </div>
        </div>
      </div>
    </footer>
  </body>
</html>